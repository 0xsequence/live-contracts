name: "payments"
version: "1"
description: "Sequence payments"

depends_on: ["sequence-v2"]

actions:
  - name: "payments-factory"
    template: "sequence-universal-deployer-2"
    arguments:
      salt: "{{salt-zero}}"
      creationCode:
        type: "constructor-encode"
        arguments:
          creationCode: "{{Contract(./build-info/payments-factory.json:PaymentsFactory).creationCode}}"
          types: ["address"]
          values: ["{{developer-multisig-01}}"]
    output: true

  - name: "payment-combiner"
    template: "erc-2470"
    arguments:
      salt: "{{salt-zero}}"
      creationCode: "{{Contract(./artifacts/payment-combiner.json).creationCode}}"
    output: true
    # Can't verify payment-combiner because the build-info I generate
    # has a different order of imports, and thus a different metadata hash.

  - name: "payment-signer-dev"
    template: "deploy-wallet-v2"
    arguments:
      implementation: "{{sequence-v2.main-module.address}}"
      salt: "0x5a3d23cc68c09f9b4e48a805f031becde6a3b9ee32a2b2b9ed742a1078e2f7b8"
    output: true

  - name: "payment-signer-next"
    template: "deploy-wallet-v2"
    arguments:
      implementation: "{{sequence-v2.main-module.address}}"
      salt: "0x83f3b8cedaa13051ca1c926997c7c835797cc4fe3913271b0039fcac1c8fcc95"
    output: true

  - name: "payment-signer-prod"
    template: "deploy-wallet-v2"
    arguments:
      implementation: "{{sequence-v2.main-module.address}}"
      salt: "0x63ca5e66c37aef85b8a9691efc1b3cc98e8f013f98922e95ffba6fe6fa087200"
    output: true

  - name: "payments-dev"
    template: "send-transaction"
    depends_on: ["payments-factory", "payment-signer-dev"]
    skip_condition:
      - type: "contract-exists"
        arguments:
          address: "0xDE280948Af8A9762B6984995C8c3c7F5AEB921Bf"
    output:
      address: "0xDE280948Af8A9762B6984995C8c3c7F5AEB921Bf"
    arguments:
      to: "{{payments-factory.address}}"
      data:
        type: "abi-encode"
        arguments:
          signature: "deploy(address,address,address)"
          values:
            - "{{developer-multisig-01}}"
            - "{{developer-multisig-01}}"
            - "{{payment-signer-dev.address}}"

  - name: "payments-next"
    template: "send-transaction"
    depends_on: ["payments-factory", "payment-signer-next"]
    skip_condition:
      - type: "contract-exists"
        arguments:
          address: "0x7AaC049C94E60a71E1aeDA4E1390F6812685eA4f"
    output:
      address: "0x7AaC049C94E60a71E1aeDA4E1390F6812685eA4f"
    arguments:
      to: "{{payments-factory.address}}"
      data:
        type: "abi-encode"
        arguments:
          signature: "deploy(address,address,address)"
          values:
            - "{{developer-multisig-01}}"
            - "{{developer-multisig-01}}"
            - "{{payment-signer-next.address}}"

  - name: "payments-prod"
    template: "send-transaction"
    depends_on: ["payments-factory", "payment-signer-prod"]
    skip_condition:
      - type: "contract-exists"
        arguments:
          address: "0x5afd8f6a09FfaD13c914b5977aF48b244279BFc7"
    output:
      address: "0x5afd8f6a09FfaD13c914b5977aF48b244279BFc7"
    arguments:
      to: "{{payments-factory.address}}"
      data:
        type: "abi-encode"
        arguments:
          signature: "deploy(address,address,address)"
          values:
            - "{{developer-multisig-01}}"
            - "{{developer-multisig-01}}"
            - "{{payment-signer-prod.address}}"

  - name: "verify-payments-factory"
    depends_on: ["payments-factory"]
    template: "verify-contract"
    arguments:
      address: "{{payments-factory.address}}"
      contract: "{{Contract(./build-info/payments-factory.json:PaymentsFactory)}}"
      constructorArguments:
        type: "constructor-encode"
        arguments:
          types: ["address"]
          values: ["{{developer-multisig-01}}"]
    output: false
